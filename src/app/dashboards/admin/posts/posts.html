<div class="posts-container">
  <!-- Header with title and create button -->
  <div class="header">
    <h1>Posts</h1>
    <button mat-flat-button color="primary" (click)="openCreateDialog()">
      <mat-icon>add</mat-icon> New Post
    </button>
  </div>

  <!-- Search bar -->
  <div class="search-container">
    <mat-form-field appearance="outline" class="search-field">
      <mat-label>Search posts</mat-label>
      <input
        matInput
        placeholder="Search by title or content"
        [(ngModel)]="searchTerm"
        (input)="onSearchChange($event.target.value)"
      />
      <mat-icon matSuffix>search</mat-icon>
    </mat-form-field>
  </div>

  <!-- Bulk actions toolbar -->
  <div class="bulk-actions" *ngIf="selection.selected.length > 0">
    <span class="selected-count">{{ selection.selected.length }} selected</span>

    <div class="action-buttons" *ngIf="isAdmin()">
      <button mat-button (click)="bulkDeleteSelected()" class="delete-action" color="warn">
        <mat-icon>delete</mat-icon> Delete Selected
      </button>
    </div>
  </div>

  <!-- Posts table -->
  <div class="table-container" [class.loading]="isLoading">
    <table mat-table [dataSource]="dataSource" matSort>
      <!-- Checkbox column -->
      <ng-container matColumnDef="select">
        <th mat-header-cell *matHeaderCellDef>
          <mat-checkbox
            (change)="$event ? toggleAllRows() : null"
            [checked]="selection.hasValue() && isAllSelected()"
            [indeterminate]="selection.hasValue() && !isAllSelected()"
          >
          </mat-checkbox>
        </th>
        <td mat-cell *matCellDef="let row">
          <mat-checkbox
            (click)="$event.stopPropagation()"
            (change)="$event ? selection.toggle(row) : null"
            [checked]="selection.isSelected(row)"
          >
          </mat-checkbox>
        </td>
      </ng-container>

      <!-- Title column -->
      <ng-container matColumnDef="title">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Title</th>
        <td mat-cell *matCellDef="let post" class="title-cell">
          <div class="title" [matTooltip]="post.title">{{ post.title }}</div>
        </td>
      </ng-container>

      <!-- Author column -->
      <ng-container matColumnDef="author">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Author</th>
        <td mat-cell *matCellDef="let post" class="author-cell">
          <span>{{ getAuthorName(post) }}</span>
        </td>
      </ng-container>

      <!-- Created At column -->
      <ng-container matColumnDef="createdAt">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Created</th>
        <td mat-cell *matCellDef="let post">
          <div class="date">
            <mat-icon>event</mat-icon>
            <span>{{ formatDate(post.createdAt) }}</span>
          </div>
        </td>
      </ng-container>

      <!-- Updated At column -->
      <ng-container matColumnDef="updatedAt">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Last Updated</th>
        <td mat-cell *matCellDef="let post">
          <div class="date">
            <mat-icon>update</mat-icon>
            <span>{{ formatDate(post.updatedAt) }}</span>
          </div>
        </td>
      </ng-container>

      <!-- Actions column -->
      <ng-container matColumnDef="actions">
        <th mat-header-cell *matHeaderCellDef>Actions</th>
        <td mat-cell *matCellDef="let post" class="actions-cell">
          <button mat-icon-button [matMenuTriggerFor]="menu">
            <mat-icon>more_vert</mat-icon>
          </button>
          <mat-menu #menu="matMenu">
            <button mat-menu-item (click)="openEditDialog(post)">
              <mat-icon>edit</mat-icon>
              <span>Edit</span>
            </button>
            <button
              mat-menu-item
              (click)="confirmDelete(post)"
              class="delete-option"
              *ngIf="isAdmin()"
            >
              <mat-icon>delete</mat-icon>
              <span>Delete</span>
            </button>
          </mat-menu>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr
        mat-row
        *matRowDef="let row; columns: displayedColumns"
        [class.row-selected]="selection.isSelected(row)"
      ></tr>
    </table>

    <!-- Empty state -->
    <div class="empty-state" *ngIf="dataSource.data.length === 0 && !isLoading">
      <mat-icon>article</mat-icon>
      <h3>No posts found</h3>
      <p>Create your first post by clicking the "New Post" button above.</p>
    </div>

    <!-- Loading state -->
    <div class="loading-overlay" *ngIf="isLoading">
      <mat-spinner></mat-spinner>
    </div>
  </div>

  <!-- Pagination -->
  <mat-paginator
    [length]="totalItems"
    [pageIndex]="pageIndex"
    [pageSize]="pageSize"
    [pageSizeOptions]="pageSizeOptions"
    (page)="onPageChange($event)"
    showFirstLastButtons
    aria-label="Select page of posts"
  >
  </mat-paginator>
</div>
